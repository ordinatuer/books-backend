(function(t){function e(e){for(var n,s,r=e[0],o=e[1],u=e[2],d=0,h=[];d<r.length;d++)s=r[d],l[s]&&h.push(l[s][0]),l[s]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n]);c&&c(e);while(h.length)h.shift()();return a.push.apply(a,u||[]),i()}function i(){for(var t,e=0;e<a.length;e++){for(var i=a[e],n=!0,r=1;r<i.length;r++){var o=i[r];0!==l[o]&&(n=!1)}n&&(a.splice(e--,1),t=s(s.s=i[0]))}return t}var n={},l={app:0},a=[];function s(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=n,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],o=r.push.bind(r);r.push=e,r=r.slice();for(var u=0;u<r.length;u++)e(r[u]);var c=o;a.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"034f":function(t,e,i){"use strict";var n=i("64a9"),l=i.n(n);l.a},4743:function(t,e,i){},"56d7":function(t,e,i){"use strict";i.r(e);i("cadf"),i("551c"),i("f751"),i("097d");var n=i("2b0e"),l=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("div",{attrs:{id:"componentsWrap"}},[i("TeilForm",{attrs:{teil:t.teilInForm},on:{addTeil:t.addTeil,fixTeil:t.fixTeil}}),i("div",{attrs:{id:"mapId"}}),i("svg",{attrs:{id:t.canvasId,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 "+t.L+" "+t.H},on:{click:[function(e){return e.ctrlKey||e.shiftKey||e.altKey||e.metaKey?null:t.canvasClick(e)},function(e){return e.ctrlKey?t.canvasCtrlClick(e):null}]}},[i("rect",{attrs:{width:t.L,height:t.H,fill:"white",x:"0",y:"0"}}),t._l(t.lines,function(e){return 0<t.lines.length?i("SvgLine",{attrs:{line:e}}):t._e()}),t._l(t.teils,function(e,n){return 0<t.teils.length?i("SvgTeil",{attrs:{teil:t.numTeil(e,n)}}):t._e()})],2)],1)])},a=[],s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"teil-form-block"},[i("b-button",{staticClass:"w100",attrs:{variant:"outline-primary"},on:{click:t.toggleForm}},[t._v("\n\t\t"+t._s(t.newButtonText)+"\n\t")]),this.formStatus?t._e():i("div",[i("b-form",{attrs:{id:"teilForm"}},[i("b-form-input",{attrs:{type:"number",name:"x"},model:{value:t.teil.x,callback:function(e){t.$set(t.teil,"x",e)},expression:"teil.x"}}),i("b-form-input",{attrs:{type:"number",name:"y"},model:{value:t.teil.y,callback:function(e){t.$set(t.teil,"y",e)},expression:"teil.y"}}),i("b-form-input",{attrs:{type:"number",name:"modelId",value:t.teil.modelId}}),i("b-form-input",{attrs:{type:"number",name:"teil_id",value:t.teil.teil_id,disabled:""}}),i("b-form-textarea",{attrs:{name:"text"},model:{value:t.teil.text,callback:function(e){t.$set(t.teil,"text",e)},expression:"teil.text"}})],1),i("b-button",{staticClass:"w100",attrs:{variant:"success"},on:{click:t.fixTeil}},[t._v("\n\t\t\tSave\n\t\t")])],1),this.formStatus?i("div",{staticClass:"new-form-block"},[i("b-form",{attrs:{id:t.newForm}},[i("b-form-input",{attrs:{name:"x",type:"number"},model:{value:t.newTeilData.x,callback:function(e){t.$set(t.newTeilData,"x",e)},expression:"newTeilData.x"}}),i("b-form-input",{attrs:{name:"y",type:"number"},model:{value:t.newTeilData.y,callback:function(e){t.$set(t.newTeilData,"y",e)},expression:"newTeilData.y"}}),i("b-form-radio",{attrs:{name:"type",value:"1"},model:{value:t.newTeilData.type,callback:function(e){t.$set(t.newTeilData,"type",e)},expression:"newTeilData.type"}},[t._v("Rectangle")]),i("b-form-radio",{attrs:{name:"type",value:"2"},model:{value:t.newTeilData.type,callback:function(e){t.$set(t.newTeilData,"type",e)},expression:"newTeilData.type"}},[t._v("Circle")]),i("b-form-radio",{attrs:{name:"type",value:"3"},model:{value:t.newTeilData.type,callback:function(e){t.$set(t.newTeilData,"type",e)},expression:"newTeilData.type"}},[t._v("Image")]),i("b-form-input",{attrs:{name:"image",value:t.imageName}}),i("b-form-file",{attrs:{name:"imagefile",id:t.newFormImage},on:{input:t.imageLoad}}),i("b-form-textarea",{attrs:{name:"text"},model:{value:t.newTeilData.text,callback:function(e){t.$set(t.newTeilData,"text",e)},expression:"newTeilData.text"}})],1),i("b-button",{staticClass:"w100",attrs:{variant:"success"},on:{click:t.newTeil}},[t._v("\n\t\t\tEmit\n\t\t")])],1):t._e()],1)},r=[],o=(i("7f7f"),{name:"TeilForm",props:["teil"],data:function(){return{formStatus:!1,newForm:"teilFormNew",newFormImage:"imageFile",defaultTeil:{x:0,y:0,l:-1,h:-1,type:1,size:150,r:60,fill:"#999",teil_id:0,modelId:null,text:"New Teil",image:null,i:0},newTeilData:{},lastNewI:null,imageName:null}},methods:{newTeil:function(){var t=new FormData(document.getElementById(this.newForm));document.getElementById(this.newFormImage);t.append("image",this.imageName),this.$emit("addTeil",this.newTeilData,t),this.newTeilData=Object.assign({},this.defaultTeil)},fixTeil:function(){var t=new FormData(document.getElementById("teilForm")),e={};e.text=t.get("text"),e.x=t.get("x"),e.y=t.get("y");var i=t.get("modelId");console.log(i),console.log(e),this.$emit("fixTeil",i,e)},toggleForm:function(){console.log("New!! "),this.formStatus||(this.newTeilData=Object.assign({},this.defaultTeil)),this.formStatus=!this.formStatus},imageLoad:function(t){var e=t.name||null;this.imageName=e,this.newTeilData.image=e}},computed:{newButtonText:function(){return this.formStatus?" Fix ":"Add"}}}),u=o,c=(i("894b"),i("2877")),d=Object(c["a"])(u,s,r,!1,null,null,null),h=d.exports,p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("line",{attrs:{id:"line"+t.line.line_id,x1:t.cxy[0],y1:t.cxy[1],x2:t.cxy[2],y2:t.cxy[3],stroke:"black","stroke-width":"20"}})},m=[],f={data:function(){return{imgSrc:"http://books.loc/img/",h:1500,l:1e3,nL:65,nH:30,padding:200}},computed:{L:function(){return this.l*this.nL+(this.nL-1)*this.padding},H:function(){return this.h*this.nH+(this.nH-1)*this.padding}},methods:{coords:function(t,e){var i=[];return void 0!==t&&(i.push(this.L/2+t.x*(this.l+this.padding)),i.push(this.H/2+t.y*(this.h+this.padding))),void 0!==e&&(i.push(this.L/2+e.x*(this.l+this.padding)),i.push(this.H/2+e.y*(this.h+this.padding))),i}}},g={name:"SvgLine",props:["line"],mixins:[f],computed:{cxy:function(){var t=this.coords(this.line.lineFrom,this.line.lineTo);return t}}},v=g,x=Object(c["a"])(v,p,m,!1,null,null,null),y=x.exports,b=function(){var t=this,e=t.$createElement,i=t._self._c||e;return 1===+t.teil.type?i("SvgRect",{attrs:{teil:t.teil}}):2===+t.teil.type?i("SvgCircle",{attrs:{teil:t.teil}}):3===+t.teil.type?i("SvgImage",{attrs:{teil:t.teil}}):t._e()},w=[],T=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("g",[i("rect",{class:"svg-teil"+t.addCss,attrs:{"data-point":"point "+t.teil.pointFront,id:"teil"+t.teil.i,rx:t.teil.r,ry:t.teil.r,x:t.x,y:t.y,width:t.h,height:t.l,fill:t.teil.fill||"#999","data-model-id":t.teil.i,"data-api-id":t.teil.teil_id,"data-type":t.teil.type}}),i("SvgTeilText",{attrs:{teil:t.teil,cxy:t.cxy}})],1)},_=[],S={computed:{addCss:function(){return null!==this.teil.pointFront?" "+this.teil.pointFront:""}}},F=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("text",{staticClass:"svg-text",attrs:{"text-anchor":"middle",x:t.cxy[0],y:t.y,"font-size":t.teil.size}},t._l(t.textStrings,function(e,n){return i("tspan",{attrs:{x:t.cxy[0],dy:0===n?0:t.lineHeight}},[t._v("\n\t\t"+t._s(e)+"\n\t")])}),0)},k=[],D=(i("28a5"),{name:"SvgTeilText",props:["teil","cxy"],computed:{textStrings:function(){var t=this.teil.text.split("\n");return t},lineHeight:function(){return 1.4*this.teil.size},y:function(){var t=this.cxy[1]+this.teil.size-this.textStrings.length/2*this.lineHeight;return t}}}),I=D,$=Object(c["a"])(I,F,k,!1,null,null,null),C=$.exports,P={name:"SvgRect",props:["teil"],mixins:[f,S],components:{SvgTeilText:C},computed:{cxy:function(){return this.coords(this.teil)},x:function(){return this.cxy[0]-this.h/2},y:function(){return this.cxy[1]-this.l/2}}},O=P,j=Object(c["a"])(O,T,_,!1,null,null,null),H=j.exports,E=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("g",[i("circle",{class:"svg-teil"+t.addCss,attrs:{id:"teil"+t.teil.i,r:t.h/2,cx:t.cxy[0],cy:t.cxy[1],fill:t.teil.fill||"#999","data-model-id":t.teil.i,"data-api-id":t.teil.teil_id,"data-type":t.teil.type}}),i("SvgTeilText",{attrs:{teil:t.teil,cxy:t.cxy}})],1)},B=[],N={name:"SvgCircle",props:["teil"],mixins:[f,S],components:{SvgTeilText:C},computed:{cxy:function(){return this.coords(this.teil)}}},M=N,A=Object(c["a"])(M,E,B,!1,null,null,null),z=A.exports,K=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("image",{class:"svg-teil"+t.addCss,attrs:{href:t.imgSrc+t.teil.image,width:t.l,height:t.h,x:t.cxy[0]-t.l/2,y:t.cxy[1]-t.h/2,"data-model-id":t.teil.i,"data-api-id":t.teil.teil_id,"data-type":t.teil.type}})},R=[],J={name:"SvgImage",props:["teil"],mixins:[f,S],computed:{cxy:function(){return this.coords(this.teil)}}},Z=J,q=Object(c["a"])(Z,K,R,!1,null,null,null),W=q.exports,G={name:"SvgTeil",props:["teil"],components:{SvgRect:H,SvgCircle:z,SvgImage:W}},Q=G,U=(i("cd05"),Object(c["a"])(Q,b,w,!1,null,null,null)),V=U.exports,X=i("b383"),Y="http://books.loc",tt={name:"app",components:{TeilForm:h,SvgLine:y,SvgTeil:V},mixins:[f],data:function(){return{mapId:"mapId",canvasId:"svgId",api:{line:{url:Y+"/lines",count:null,current:1,data:"lines",load:!1},teil:{url:Y+"/teils",count:null,current:1,data:"teils",load:!1}},lines:[],teils:[],teilInForm:{},linePoints:[],linePointsFront:[]}},mounted:function(){this.bounds=[[0,0],[this.L,this.H]],this.map=L.map("mapId"),this.map.fitBounds(this.bounds),this.map.setMaxBounds(this.bounds),this.map.setMinZoom(4),this.map.setMaxZoom(7);var t=document.getElementById(this.canvasId);L.svgOverlay(t,this.bounds,{interactive:!0}).addTo(this.map),this.getData(this.api.line)},methods:{numTeil:function(t,e){return t.i=e,t},addTeil:function(t,e){if(t){var i=e,n=this;this.$http({method:"post",url:this.api.teil.url,data:i,headers:{"Content-type":"multipart/form-data"}}).then(function(t){n.teils.push(t.data)}).catch(function(t){})}},fixTeil:function(t,e){if(t){var i=this.teils[t].teil_id;this.$http({method:"PATCH",url:this.api.teil.url+"/"+i,data:X.stringify(e),headers:{"Content-type":"application/x-www-form-urlencoded"}}).then(function(t){}).catch(function(t){})}},getData:function(t){var e=this;t.current;e.$http.get(t.url+"?page="+t.current).then(function(i){null===t.count&&(t.count=+i.request.getResponseHeader("x-pagination-page-count")),t.current++,e[t.data]=e[t.data].concat(i.data)}).catch(function(t){})},canvasClick:function(t){var e=t.target,i=(e.getAttribute("data-api-id"),e.getAttribute("data-model-id"));i&&(this.teilInForm=this.teils[i],this.teilInForm.modelId=i)},canvasCtrlClick:function(t){var e=t.target.getAttribute("data-api-id")||null;if(null!==e){var i=t.target.getAttribute("data-model-id");switch(this.linePoints.length){case 0:this.linePoints.push(e),this.linePointsFront.push(i);break;case 1:if(this.linePoints[0]===e)break;this.linePoints.push(e),this.linePointsFront.push(i);break}}else 2===this.linePoints.length&&this.addLine()},addLine:function(){var t=this,e={line_from:this.linePoints[0],line_to:this.linePoints[1]};this.$http({method:"POST",url:this.api.line.url,data:e,headers:{"Content-type":"application/json; charset=utf-8"}}).then(function(e){201===e.status&&t.lines.push(e.data),t.linePointsClear()}).catch(function(t){})},linePointsClear:function(){this.linePoints=[];var t=this.linePointsFront;t[0]&&this.$set(this.teils[t[0]],"pointFront",null),t[1]&&this.$set(this.teils[t[1]],"pointFront",null),this.linePointsFront=[]}},watch:{linePointsFront:function(t){t[0]&&this.$set(this.teils[t[0]],"pointFront","point-start"),t[1]&&this.$set(this.teils[t[1]],"pointFront","point-stop")},lines:function(){this.api.line.load||(this.api.line.current<=this.api.line.count||null===this.api.line.count?this.getData(this.api.line):(this.api.line.load=!0,this.getData(this.api.teil)))},teils:function(){this.api.teil.load||(this.api.teil.current<=this.api.teil.count||null===this.api.teil.count?this.getData(this.api.teil):this.api.line.teil=!0)}}},et=tt,it=(i("034f"),Object(c["a"])(et,l,a,!1,null,null,null)),nt=it.exports,lt=i("5f5b"),at=(i("f9e3"),i("2dd8"),i("e11eb"),i("6cc5"),i("bc3a")),st=i.n(at);n["default"].use(lt["a"]),n["default"].prototype.$http=st.a,n["default"].config.productionTip=!1,new n["default"]({render:function(t){return t(nt)}}).$mount("#app")},"64a9":function(t,e,i){},8238:function(t,e,i){},"894b":function(t,e,i){"use strict";var n=i("4743"),l=i.n(n);l.a},cd05:function(t,e,i){"use strict";var n=i("8238"),l=i.n(n);l.a}});
//# sourceMappingURL=app.de12c6b0.js.map